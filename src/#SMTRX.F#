
 450  C **********************************************************************
 451  IMPLICIT REAL*8 (A-H, O-Z)
 452  COMPLEX*16 SUMR, SUMG, SR, CIM, CCIM,CIL,DCMPLX,YLM,CDEXP,CXPRDK,
 4531 SRC
 454  REAL*8 DREAL, DIMAG
 455  COMMON /B1/ CIM, CCIM, C(256), FAC(13), DAC(13), NGLN(10),
 4561 ALAMDA, TWOPI, FPL30M, SWS,VOL,SOO,SWSL,FPLAM RMAX,GMAX,ICNVRG,
 4572 NUMVR, NUMVG, NQ, NR0, NL2, NL2P, KLM0, NL, NLM, LMQ, NOWRT, IDIM
 458  COMMON /B2/ SRKLP(2916), SIKLP(2916)
 459  COMMON /LDATA/LL(49), MM(49)
 460  COMMON /VEC/BSX(3),BSY(3),BSZ(3),BKX(3),BKY(3),BKZ(3),QX(6),QY(6),
 4611 QZ(6), ASX(500), ASY(500), ASZ(500), AKX(500), AKY(300), AKZ(300),
 4622 DR(500),DG(300),
 4633 USX(500),USY(500),USZ(500),UKX(300),UKY(300),UKZ(300)
 464  COMMON/YLMD/YLM(49)
 465  DIMENSION GLNS(500,1),FBLN(500,7),BDOTQ(500),DRQ(500),
 4661 SR(49), CXPRDK(500), SUMR(49), SUMG(49)
467100FORMAT(1H ,9(1PE13.5))
468101FORMAT(1H ,///)
469102FORMAT(1H0,10X,'QQ DIAGONAL BLOCK',/)
470103FORMAT(1H0,10X,1PE11.3)
471104FORMAT(1H0,10X,'QP Q OFF DIAGONAL BLOCK ', 'QP, Q =',2I5,/)
472105FORMAT(1H0,25X,'CONVERGENCE TEST')
473106FORMAT(1H0,'RECIPROCAL SPACE SUMS',/)
474107FORMAT(1H0,'REAL SPACE SUMS',/)
 475
 476  C     QQ DIAGONAL BLOCKS
 477
 478
 479  PKX=PKXP
 480  PKY=PKYP
 481  PKZ=PKZP
 482  CXPRDK(1)=DCHPLX(1.D00,0.D00)
 483  DO 22 I=2,NRO
 484     DRI=DR(I)
 485     USX(I)=ASX(I)/DRI
 486     USY(I)=ASY(I)/DRI
 487     USZ(I)=ASZ(I)/DRI
 488     PDR=PKX*ASX(I)+PKY*ASY(I)+PKZ*ASZ(I)
 489     CXPRDK(I)=CDEXP(PDR*CIM)
 490     ALFA=ALAMDA*DRI
 491     C    CONVERGENCE FUNCTION, REAL SPACE
 492
 493  DO 25 LP=1, NL2P
 494     L=LP-1
 495     NG=NGLN(LP)
49625    GLNS(I,LP)=GLN(ALFA,L,NG)
49722    CONTINUE
 498     DO 35 I=l,NUMVG
 499        X=AKX(I)+PKX
 500        Y=AKY(I)+PKY
 501        Z=AKZ(I)+PKZ
 502        D=DSQRT(X*X+Y*Y+Z*Z)
 503        IF(D.GT.GMAX) GO TO 35
 504        BETA=D/ALAMDA
 505        UKX(I)=X/D
 506        UKY(I)=Y/D
 507               UKZ(I)=Z/D                                                                  ~